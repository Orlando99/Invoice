"use strict";invoicesUnlimited.controller("AccountActController",["$scope","$state","userFullFactory","signUpFactory",function(e,n,t,a){a.getFactory("User").entity.length||n.go("login"),e.goNext=function(){a.getFactory("User").entity.length&&n.go("signup.merchantAccount")}}]),invoicesUnlimited.controller("AccountInfoController",["$q","$rootScope","$scope","$state","signUpFactory","userFactory",function(e,n,t,a,i,o){function s(){for(var e in t.accountInfo)i.setField("AccountInfo",{field:e,value:t.accountInfo[e]});return i.setField("AccountInfo",{field:"inPerson",value:!1}),i.create("AccountInfo").then(function(e){var n;if(n=e.length?i.save("User",{accountInfo:e,company:t.businessName,phonenumber:t.phoneNumber}).then(function(){return i.save("BusinessInfo",{businessName:t.businessName,phoneNumber:t.phoneNumber})}):i.save("User",{accountInfo:i.getFactory("AccountInfo").entity[0],company:t.businessName,phonenumber:t.phoneNumber}).then(function(){return i.save("BusinessInfo",{businessName:t.businessName,phoneNumber:t.phoneNumber})}))return n})}function r(){for(var e in t.accountInfo)if(!t.accountInfo[e])return!1;return!0}if(i.getFactory("User").entity.length){i.getFactory("User");var u=void 0;if(e.when(o.entity[0].fetch()).then(function(e){u=e,t.businessName=""}),n.fromPaymentSettings){var l=i.getFactory("User").entity[0];i.setField("AccountInfo","userID",l),i.setField("AccountInfo","organization",l.get("selectedOrganization")),showLoader(),i.getFactory("Role").load().then(function(){hideLoader()},function(e){hideLoader(),console.log(e.message)})}$("input").keyup(function(e){var n=e.target.id;$("#"+n+"-error").css("display","none"),$("#"+n).removeClass("error")}),$("select").bind("change keyup",function(e){var n=e.target.id;$("#"+n+"-error").css("display","none"),$("#"+n).removeClass("error")}),$.validator.addMethod("AvgSaleRequired",function(e,n){return"avgSaleTitle"!=e}),$.validator.addMethod("MonthlySalesRequired",function(e,n){return"monthlySalesTitle"!=e}),$("[name=routingNumber]").mask("000000000"),$("[name=accountNumber]").mask("0000000000"),$(".mobilePhone").mask("9 (999) 999-9999",mobileOptions),$("#signUpForm").validate({onfocusout:!0,rules:{avgSale:{required:!0,AvgSaleRequired:!0},monthlySales:{required:!0,MonthlySalesRequired:!0},bankName:"required",routingNumber:"required",accountNumber:"required",phoneNumber:"required",businessName:"required"},messages:{avgSale:"Please specify your average sale per customer!",monthlySales:"Please specify your estimated montly credit card sales!",bankName:"Please specify your bank name!",routingNumber:"Please specify your bank routing number!",accountNumber:"Please specify your bank account number!",phoneNumber:"Please specify your phone number!",businessName:"Please specify your business name!"}}),t.avgSaleList=[],t.monthlySalesList=[];var c=0;do{c?1==c?c=5:c+=c<100?5:c<1e3?50:c<1e4?500:5e3:c=1,t.avgSaleList.push({value:"$ "+(5e4==c?c+"+":c)})}while(5e4!=c);c=0;do{c+=c<25e3?500:5e3,t.monthlySalesList.push({value:"$ "+(1e5==c?c+"+":c)})}while(1e5!=c);t.accountInfo={bankName:"",routingNumber:"",accountNumber:"",avgSale:"",monthlySales:""},t.saveAccountInfo=function(){$("#signUpForm").valid()&&(showLoader(),s().then(function(){hideLoader(),a.go("signup.signature")},function(e){hideLoader(),console.log(e.message)}))},t.saveAndContinueLater=function(){if(!r())return showLoader(),void a.go("signup.invoiceTemplateInfo");$("#signUpForm").valid()?(showLoader(),s().then(function(){hideLoader(),i.getFactory("User").entity.length&&a.go("signup.invoiceTemplateInfo")},function(e){hideLoader(),console.log(e.message)})):showLoader()}}else a.go("signup")}]),$(document).ready(function(){$.validator.addMethod("OwhershipTypeNotSelected",function(e,n){return"Ownership Type"!=e}),$.validator.addMethod("FederalTaxIDisMissing",function(e,n){return"none"==$(n).css("display")||""!=e}),$.validator.addMethod("exactlength",function(e,n,t){return e.length==t})}),invoicesUnlimited.controller("BusinessInfoController",["$q","$rootScope","$scope","$state","signUpFactory","userFactory","roleFactory",function(e,n,t,a,i,o,s){function r(){if("signup.invoiceTemplateInfo"==p||$("#signUpForm").valid()){i.setDefaultValues(),showLoader();for(var e in t.bsnsInfo)i.setField("BusinessInfo",{field:e,value:t.bsnsInfo[e]});i.create("BusinessInfo").then(function(e){return e.length?i.save("User",{businessInfo:e}):i.save("User",{businessInfo:i.getFactory("BusinessInfo").entity[0]})},function(e){e.length||console.log(e.message),e.forEach(function(e){console.log(e.message)})}).then(function(){u()},errorCallback)}}function u(){showLoader(),d.set("fullName",t.fullName),e.when(c.save()).then(function(){l().then(function(){hideLoader(),a.go(p)},function(e){hideLoader(),console.log(e.message)})})}function l(){t.principalInfo.dob=formatDate(t.dob,"MM-DD-YYYY"),t.toggleHomeChecked&&b.forEach(function(e){t.principalInfo[e]=t.bsnsInfo[e]});for(var e in t.principalInfo)i.setField("PrincipalInfo",{field:e,value:t.principalInfo[e]});return i.create("PrincipalInfo").then(function(e){var n;if(n=e.length?i.save("User",{principalInfo:e}):i.save("User",{principalInfo:i.getFactory("PrincipalInfo").entity[0]}))return n})}if(o.entity.length){var c=i.getFactory("User"),d=void 0;if(e.when(o.entity[0].fetch()).then(function(e){d=e}),n.fromPaymentSettings){var f=o.entity[0];i.setField("PrincipalInfo","userID",f),i.setField("PrincipalInfo","organization",f.get("selectedOrganization")),showLoader();var m=void 0,g=[];m=e.when(f.get("businessInfo").fetch()).then(function(e){for(var n=0;n<b.length;++n)i.setField("BusinessInfo",b[n],e.get(b[n]));t.bsnsInfo=e,t.toggleHomeInfo()}),g.push(m),m=e.when(i.getFactory("Role").load()),g.push(m),e.all(g).then(function(){hideLoader()},function(e){hideLoader(),console.log(e.message)})}$("input").keyup(function(e){var n=e.target.id;$("#"+n+"-error").css("display","none"),$("#"+n).removeClass("error")}),$("#dob").keyup(function(){var e=$("#dob").val();if(e.length)if(1==e.length){if(e>1&&e<10){$("#dob").unmask();var n="0";n+=e,$("#dob").val(n)}1==(t=parseInt(e.charAt(0)))?($("#dob").unmask(),$("#dob").mask("AY/S0/0000",{translation:{A:{pattern:/[0-1]/},Y:{pattern:/[0-2]/},S:{pattern:/[0-9]/}}})):($("#dob").unmask(),$("#dob").mask("AY/S0/0000",{translation:{A:{pattern:/[0-1]/},Y:{pattern:/[0-9]/},S:{pattern:/[0-9]/}}}))}else if(2==e.length||3==e.length)$("#dob").unmask(),$("#dob").mask("A0/SY/0000",{translation:{A:{pattern:/[0-1]/},Y:{pattern:/[0-9]/},S:{pattern:/[0-9]/}}});else if(4==e.length){var t=parseInt(e.charAt(3));if(t>3&&t<10){var a="0";a+=t;var i=$("#dob").val().split("/")[0]+"/"+a;$("#dob").val(i)}3==t?($("#dob").unmask(),$("#dob").mask("A0/SY/0000",{translation:{A:{pattern:/[0-1]/},Y:{pattern:/[0-1]/},S:{pattern:/[0-3]/}}})):($("#dob").unmask(),$("#dob").mask("A0/SY/0000",{translation:{A:{pattern:/[0-1]/},Y:{pattern:/[0-9]/},S:{pattern:/[0-9]/}}}))}else $("#dob").unmask(),$("#dob").mask("AY/S0/0000",{translation:{A:{pattern:/[0-1]/},Y:{pattern:/[0-9]/},S:{pattern:/[0-3]/}}});else $("#dob").unmask(),$("#dob").mask("AY/S0/0000",{translation:{A:{pattern:/[0-9]/},Y:{pattern:/[0-9]/},S:{pattern:/[0-9]/}}})}),$("#dob").mask("AY/S0/0000",{translation:{A:{pattern:/[0-9]/},Y:{pattern:/[0-9]/},S:{pattern:/[0-9]/}}}),$("#signUpForm").validate({onkeyup:function(e){$(e).valid()},onfocusout:!1,rules:{company:"required",fullName:"required",dob:"required",ssn:"required",streetName:"required",city:"required",state:"required",zipCode:"required",ownershipType:{OwhershipTypeNotSelected:!0},federalTaxID:{FederalTaxIDisMissing:!0,exactlength:10}},messages:{company:"Please specify your business name!",streetName:"Please specify your business street name!",city:"Please specify your business city!",state:"Please specify your business state!",dob:"Please specify your Date Of Birth!",ssn:"Please specify your SSN!",fullName:"Please specify your Full Name!",zipCode:"Please specify your business zip code!",ownershipType:{OwhershipTypeNotSelected:"Please select your ownership type!"},federalTaxID:{FederalTaxIDisMissing:"Please specify your Federal Tax ID!",exactlength:"Please enter exactly 9 digits"}}}),$('input[name="federalTaxID"]').mask("00-0000000"),o.entity[0].get("company"),t.bsnsInfo={businessName:"",streetName:"",city:"",state:"",zipCode:"",federalTaxID:"",ownershipType:"Ownership Type"},t.options=[{name:"ownershipTitle",value:"Ownership Type"},{name:"Individual or Sole Proprietor",value:"Individual or Sole Proprietor"},{name:"Limited Liability Compnay",value:"Limited Liability Compnay"},{name:"Non Profit",value:"Non Profit"},{name:"S-Corporation",value:"S-Corporation"},{name:"C-Corporation",value:"C-Corporation"},{name:"Partenership",value:"Partenership"}];var p="signup.account-info";t.saveAndLaterBusinessInfo=function(){p="signup.invoiceTemplateInfo",r()},t.saveBusinessInfo=r,$(".federal-tax-id-input").hide(),$(".ownershipTypeInput").show(),t.federalTaxIdClick=function(){var e=t.x2;$(".federal-tax-id-input").hide(),t.bsnsInfo.federalTaxID="",1==e&&$(".federal-tax-id-input").show()},$("[name=ssn]").mask("000-00-0000"),t.toggleHomeChecked=!0,t.principalInfo={streetName:"",city:"",state:"",zipCode:"",dob:"",ssn:"",ownershipType:""};var b=["streetName","city","state","zipCode","ownershipType"];t.toggleHomeInfo=function(){b.forEach(function(e){t.principalInfo[e]=t.bsnsInfo[e]})},t.openDatePicker=function(e){switch(e){case 1:t.openPicker1=!0}}}else a.go("signup")}]),invoicesUnlimited.controller("ConfirmController",["$scope","$state","userFullFactory","signUpFactory",function(e,n,t,a){a.getFactory("User").entity.length||n.go("signup"),e.getStarted1=function(){a.getFactory("User").entity.length&&(a.getFactory("User").entity[0].get("tutorial")?n.go("dashboard"):n.go("signup.invoiceTemplateInfo"))}}]),invoicesUnlimited.controller("InvoiceTemplateInfoController",["$q","$rootScope","$scope","$state","signUpFactory","userFactory","roleFactory",function(e,n,t,a,i,o,s){function r(){var e=l.get("principalInfo"),n=l.get("accountInfo"),a=void 0;a=n?{status:"New Lead",list:IRIS_SOURCE,BusinessName:t.bsnsInfo.businessName,Email:l.get("email"),BusinessAddress:t.bsnsInfo.streetName,MailingAddress:t.bsnsInfo.streetName,BusinessState:t.bsnsInfo.state,MailingState:t.bsnsInfo.state,BusinessZip:t.bsnsInfo.zipCode,MailingZIP:t.bsnsInfo.zipCode,BusinessCity:t.bsnsInfo.city,MailingCity:t.bsnsInfo.city,OfficePhone:t.bsnsInfo.phoneNumber,MailingContact:t.bsnsInfo.phoneNumber,ContactName:t.fullName,HomeAddress:e.get("streetName"),State2:e.get("state"),Zip:e.get("zipCode"),City2:e.get("city"),DateOfBirthMmDdYyyy:e.get("dob"),SocialSecurity:e.get("ssn"),BankName:n.get("bankName"),BankRouting:n.get("routingNumber"),BankAccount2:n.get("accountNumber"),Business_Volume:n.get("monthlySales")}:e?{status:"New Lead",list:IRIS_SOURCE,BusinessName:t.bsnsInfo.businessName,Email:l.get("email"),BusinessAddress:t.bsnsInfo.streetName,MailingAddress:t.bsnsInfo.streetName,BusinessState:t.bsnsInfo.state,MailingState:t.bsnsInfo.state,BusinessZip:t.bsnsInfo.zipCode,MailingZIP:t.bsnsInfo.zipCode,BusinessCity:t.bsnsInfo.city,MailingCity:t.bsnsInfo.city,OfficePhone:t.bsnsInfo.phoneNumber,MailingContact:t.bsnsInfo.phoneNumber,ContactName:t.fullName,HomeAddress:e.get("streetName"),State2:e.get("state"),Zip:e.get("zipCode"),City2:e.get("city"),DateOfBirthMmDdYyyy:e.get("dob"),SocialSecurity:e.get("ssn")}:{status:"New Lead",list:IRIS_SOURCE,BusinessName:t.bsnsInfo.businessName,Email:l.get("email"),BusinessAddress:t.bsnsInfo.streetName,MailingAddress:t.bsnsInfo.streetName,BusinessState:t.bsnsInfo.state,MailingState:t.bsnsInfo.state,BusinessZip:t.bsnsInfo.zipCode,MailingZIP:t.bsnsInfo.zipCode,BusinessCity:t.bsnsInfo.city,MailingCity:t.bsnsInfo.city,OfficePhone:t.bsnsInfo.phoneNumber,MailingContact:t.bsnsInfo.phoneNumber,ContactName:t.fullName},$.ajax({method:"POST",type:"POST",url:CRM_URL,data:a}).then(function(e){console.log("New CRM Lead Submitted")},function(e){console.error("New  CRM Lead Sumission failed")})}function u(){var e=l.get("principalInfo"),n=l.get("accountInfo"),a=void 0;a=n?"Business Name: "+t.bsnsInfo.businessName+"<br><br>Email: "+l.get("email")+"<br><br>Business Address: "+t.bsnsInfo.streetName+"<br><br>Business State: "+t.bsnsInfo.state+"<br><br>Business Zip: "+t.bsnsInfo.zipCode+"<br><br>Business City: "+t.bsnsInfo.city+"<br><br>Office Phone: "+t.bsnsInfo.phoneNumber+"<br><br>Contact Name: "+t.fullName+"<br><br>Home Address: "+e.get("streetName")+"<br><br>Home State: "+e.get("state")+"<br><br>Home Zip: "+e.get("zipCode")+"<br><br>Home City: "+e.get("city")+"<br><br>Date Of Birth: "+e.get("dob")+"<br><br>Social Security: "+e.get("ssn")+"<br><br>Bank Name: "+n.get("bankName")+"<br><br>Bank Routing: "+n.get("routingNumber")+"<br><br>Bank Account: "+n.get("accountNumber")+"<br><br>Monthly Volume"+n.get("monthlySales"):e?"Business Name: "+t.bsnsInfo.businessName+"<br><br>Email: "+l.get("email")+"<br><br>Business Address: "+t.bsnsInfo.streetName+"<br><br>Business State: "+t.bsnsInfo.state+"<br><br>Business Zip: "+t.bsnsInfo.zipCode+"<br><br>Business City: "+t.bsnsInfo.city+"<br><br>Office Phone: "+t.bsnsInfo.phoneNumber+"<br><br>Contact Name: "+t.fullName+"<br><br>Home Address: "+e.get("streetName")+"<br><br>Home State: "+e.get("state")+"<br><br>Home Zip: "+e.get("zipCode")+"<br><br>Home City: "+e.get("city")+"<br><br>Date Of Birth: "+e.get("dob")+"<br><br>Social Security: "+e.get("ssn"):"Business Name: "+t.bsnsInfo.businessName+"<br><br>Email: "+l.get("email")+"<br><br>Business Address: "+t.bsnsInfo.streetName+"<br><br>Business State: "+t.bsnsInfo.state+"<br><br>Business Zip: "+t.bsnsInfo.zipCode+"<br><br>Business City: "+t.bsnsInfo.city+"<br><br>Office Phone: "+t.bsnsInfo.phoneNumber+"<br><br>Contact Name: "+t.fullName,Parse.Cloud.run("sendMailgunHtml",{toEmail:LEAD_EMAIL,fromEmail:"no-reply@invoicesunlimited.com",subject:"New Lead From: "+IRIS_SOURCE,html:"<p>"+a+"</p>"}).then(function(e){console.log(e)},function(e){console.log(msg)})}if(o.entity.length){var l=void 0,c=void 0;showLoader(),e.when(o.entity[0].fetch()).then(function(n){l=n;var a=n.get("businessInfo");t.fullName=n.get("fullName"),a?e.when(a.fetch()).then(function(e){c=e,t.bsnsInfo=e,t.bsnsInfo.businessName=e.get("businessName"),t.bsnsInfo.streetName=e.get("streetName"),t.bsnsInfo.city=e.get("city"),t.bsnsInfo.state=e.get("state"),t.bsnsInfo.zipCode=e.get("zipCode"),t.bsnsInfo.phoneNumber=e.get("phoneNumber"),hideLoader()}):hideLoader()}),$("input").keyup(function(e){var n=e.target.id;$("#"+n+"-error").css("display","none"),$("#"+n).removeClass("error")}),$("#signUpForm").validate({onkeyup:function(e){$(e).valid()},onfocusout:!1,rules:{company:"required",fullName:"required",streetName:"required",city:"required",state:"required",zipCode:"required",phoneNumber:{minlength:10,required:!0}},messages:{streetName:"Please specify your business street name!",city:"Please specify your business city!",state:"Please specify your business state!",fullName:"Please specify your Full Name!",zipCode:"Please specify your business zip code!",company:"Please specify your business name",phoneNumber:{minlength:"Please enter a valid phone number!",required:"Please specify your phone number!"}}}),t.bsnsInfo={streetName:"",city:"",state:"",zipCode:""},t.saveBusinessInfo=function(){if($("#signUpForm").valid()){showLoader();var n=t.bsnsInfo;if(!c){var i=new Parse.Object.extend("BusinessInfo");c=new i}c.set("businessName",n.businessName),c.set("streetName",n.streetName),c.set("city",n.city),c.set("state",n.state),c.set("zipCode",n.zipCode),c.set("phoneNumber",n.phoneNumber),c.set("userID",l),c.set("organization",l.get("selectedOrganization")),e.when(c.save()).then(function(i){l.set("company",n.businessName),l.set("fullName",t.fullName),l.set("phonenumber",n.phoneNumber),l.set("tutorial",1),l.set("businessInfo",i),l.get("signatureImage")||(r(),u()),e.when(l.save()).then(function(n){var i=new Parse.Query("ProjectUser");i.equalTo("userName",n.get("username")),e.when(i.first()).then(function(n){n.set("title",t.fullName),n.set("companyName",t.bsnsInfo.businessName),e.when(n.save()).then(function(e){fromTutorial=!0,hideLoader(),a.go("dashboard.settings.app-preferences")})})})})}},t.nextClicked=function(){$(".tutorial").hide()},$(document).click(function(){$(".tutorial").hide()}),$(".mobilePhone").mask("9 (999) 999-9999",mobileOptions)}else a.go("signup")}]),invoicesUnlimited.controller("MerchantAccountController",["$rootScope","$scope","$state","userFullFactory","signUpFactory","userFactory","roleFactory",function(e,n,t,a,i,o,s){function r(){showLoader(),i.setDefaultValues();for(var e in n.bsnsInfo)i.setField("BusinessInfo",{field:e,value:n.bsnsInfo[e]});i.setField("BusinessInfo",{field:"businessName",value:""}),i.create("BusinessInfo").then(function(e){return i.save("User",{businessInfo:e})},function(e){e.length||console.log(e.message),e.forEach(function(e){console.log(e.message)})}).then(function(){hideLoader(),t.go("signup.invoiceTemplateInfo")},errorCallback)}if(i.getFactory("User").entity.length||t.go("signup"),n.goNext=function(){i.getFactory("User").entity.length&&t.go("signup.business-info")},n.skipStep=function(){r()},e.fromPaymentSettings){var u=o.entity[0];i.setField("User","company",u.get("company")),i.setField("BusinessInfo","organization",u.get("selectedOrganization"))}}]),invoicesUnlimited.controller("PrincipalInfoController",["$q","$rootScope","$scope","$state","signUpFactory","userFactory",function(e,n,t,a,i,o){function s(){t.principalInfo.dob=formatDate(t.dob,"MM-DD-YYYY");for(var e in t.principalInfo)i.setField("PrincipalInfo",{field:e,value:t.principalInfo[e]});return i.create("PrincipalInfo").then(function(e){var n=i.save("User",{principalInfo:e});if(n)return n})}function r(){return d.forEach(function(e){if(!t.principalInfo[e])return!1}),!(!t.dob||!t.principalInfo.ssn)}var u=i.getFactory("User"),l=void 0;if(e.when(o.entity[0].fetch()).then(function(e){l=e}),$("[name=ssn]").mask("000-00-0000"),i.getFactory("User").entity.length){if($("input").keyup(function(e){var n=e.target.id;$("#"+n+"-error").css("display","none"),$("#"+n).removeClass("error")}),!i.getVerification.code()&&!n.fromPaymentSettings)return u.logout(),void a.go("signup");$("#signUpForm").validate({onkeyup:function(e){$(e).valid()},onfocusout:!1,rules:{streetName:"required",city:"required",state:"required",zipCode:"required",dob:"required",ssn:"required",fullName:"required"},messages:{streetName:"Please specify your street name!",city:"Please specify your city!",state:"Please specify your state!",zipCode:"Please specify your zip code!",dob:"Please specify your Date Of Birth!",ssn:"Please specify your SSN!",fullName:"Please specify your Full Name!"}});var c=function(e){return i.getField("BusinessInfo",e)};t.principalInfo={streetName:c("streetName"),city:c("city"),state:c("state"),zipCode:c("zipCode"),dob:"",ssn:""},t.fullName="",t.toggleHomeChecked=!0;var d=["streetName","city","state","zipCode"];if(t.toggleHomeInfo=function(){d.forEach(function(e){t.principalInfo[e]=t.toggleHomeChecked?c(e):""})},n.fromPaymentSettings){var f=u.entity[0];i.setField("PrincipalInfo","userID",f),i.setField("PrincipalInfo","organization",f.get("selectedOrganization")),showLoader();var m=void 0,g=[];m=e.when(f.get("businessInfo").fetch()).then(function(e){for(var n=0;n<d.length;++n)i.setField("BusinessInfo",d[n],e.get(d[n]));t.toggleHomeInfo()}),g.push(m),m=e.when(i.getFactory("Role").load()),g.push(m),e.all(g).then(function(){hideLoader()},function(e){hideLoader(),console.log(e.message)})}t.$watch(function(){return i.get("BusinessInfo")},function(e,n){n!=e&&d.forEach(function(n){t.principalInfo[n]=e[n]})},!0),t.savePrincipalInfo=function(){$("#signUpForm").valid()&&(showLoader(),l.set("fullName",t.fullName),e.when(u.save()).then(function(){s().then(function(){hideLoader(),a.go("signup.account-info")},function(e){hideLoader(),console.log(e.message)})}))},t.saveAndContinueLater=function(){r()?$("#signUpForm").valid()&&(showLoader(),s().then(function(){hideLoader(),i.getFactory("User").entity.length&&a.go("dashboard")},function(e){hideLoader(),console.log(e.message)})):a.go("dashboard")},t.openDatePicker=function(e){switch(e){case 1:t.openPicker1=!0}}}else a.go("signup")}]),invoicesUnlimited.controller("SignatureController",["$rootScope","$scope","$state","signUpFactory","$ocLazyLoad",function(e,n,t,a,i){function o(){var e=s.entity[0],n=e.get("businessInfo"),t=e.get("principalInfo"),a=e.get("accountInfo"),i=void 0;i="Business Name: "+n.get("businessName")+"<br><br>Email: "+e.get("email")+"<br><br>Business Address: "+n.get("streetName")+"<br><br>Business State: "+n.get("state")+"<br><br>Business Zip: "+n.get("zipCode")+"<br><br>Business City: "+n.get("city")+"<br><br>Office Phone: "+n.get("phoneNumber")+"<br><br>Contact Name: "+e.fullName+"<br><br>Home Address: "+t.get("streetName")+"<br><br>Home State: "+t.get("state")+"<br><br>Home Zip: "+t.get("zipCode")+"<br><br>Home City: "+t.get("city")+"<br><br>Date Of Birth: "+t.get("dob")+"<br><br>Social Security: "+t.get("ssn")+"<br><br>Bank Name: "+a.get("bankName")+"<br><br>Bank Routing: "+a.get("routingNumber")+"<br><br>Bank Account: "+a.get("accountNumber")+"<br><br>Bank Account: "+a.get("accountNumber")+"<br><br>Monthly Volume: "+a.get("monthlySales")+"<br><br>Signature URL: "+e.get("signatureImage").get("imageFile")._url,Parse.Cloud.run("sendMailgunHtml",{toEmail:LEAD_EMAIL,fromEmail:"no-reply@invoicesunlimited.com",subject:"New Lead From: "+IRIS_SOURCE,html:"<p>"+i+"</p>"}).then(function(e){console.log(e)},function(e){console.log(msg)})}var s=a.getFactory("User");if(s.entity.length){if(e.fromPaymentSettings){var r=s.entity[0];a.setField("User","fullName",r.get("fullName")),a.setField("Signature","userID",r),a.setField("Signature","organization",r.get("selectedOrganization")),showLoader(),a.getFactory("Role").load().then(function(){hideLoader()},function(e){hideLoader(),console.log(e.message)})}$("#sig").signature(),$("#clear").click(function(){$("#sig").signature("clear")}),n.fullName=a.getField("User","fullName"),$("h2.text-uppercase").css({padding:"50px 0",margin:0}),$(".signature").css({height:$(window).height()-$(".sticky-nav").height()-2*parseInt($(".sticky-nav").css("padding-top"))-1}),n.submitSignature=function(){var e=!1,i=!1;if($("#sigForm").validate().resetForm(),$("#sig").signature("isEmpty")?$("#sigForm").validate().showErrors({sigError:"Please provide signature"}):e=!0,$('input[name="agree-box"]:checked').length?i=!0:$("#sigForm").validate().showErrors({"agree-box":"Please agree to the Terms"}),e&&i){showLoader();var r=$(".kbw-signature canvas")[0].toDataURL().replace("data:image/png;base64,","");a.setField("Signature",{field:"imageName",value:"Signature_"+s.entity[0].id}),a.setField("Signature",{field:"imageFile",value:new Parse.File("Signature.png",{base64:r})});var u=a.create("Signature");u?u.then(function(e){var n=a.save("User",{signatureImage:a.getFactory("Signature").entity[0]});if(n)return n;window.reload()},function(e){console.log(e.messge)}).then(function(){o();var e=s.entity[0],a=e.get("businessInfo"),i=e.get("principalInfo"),r=e.get("accountInfo");e.fullName&&(e.fullName.split(" ")[0],e.fullName.split(" ").length>1&&n.fullName.split(" ")[1]);var u=void 0;u={status:"New Lead",list:IRIS_SOURCE,BusinessName:a.get("businessName"),Email:e.get("email"),BusinessAddress:a.get("streetName"),MailingAddress:a.get("streetName"),BusinessState:a.get("state"),MailingState:a.get("state"),BusinessZip:a.get("zipCode"),MailingZIP:a.get("zipCode"),BusinessCity:a.get("city"),MailingCity:a.get("city"),OfficePhone:a.get("phoneNumber"),MailingContact:a.get("phoneNumber"),ContactName:e.fullName,HomeAddress:i.get("streetName"),State2:i.get("state"),Zip:i.get("zipCode"),City2:i.get("city"),DateOfBirthMmDdYyyy:i.get("dob"),SocialSecurity:i.get("ssn"),BankName:r.get("bankName"),BankRouting:r.get("routingNumber"),BankAccount2:r.get("accountNumber"),Business_Volume:r.get("monthlySales"),Signature_Url:e.get("signatureImage").get("imageFile")._url},$.ajax({method:"POST",type:"POST",url:CRM_URL,data:u}).then(function(e){console.log("New CRM Lead Submitted"),hideLoader()},function(e){console.error("New CRM Lead Sumission failed"),hideLoader()}),t.go("signup.confirm")},function(e){console.log(e.messge)}):t.go("signup")}}}else t.go("signup")}]),$(document).ready(function(){$.validator.addMethod("NotFullName",function(e,n){var t=e.match(/[^ ]+/g);if(1==t.length)return!1;var a=t.reduce(function(e,n,t){return e+(t?" ":"")+n.capitalize()},"");return $(n).val(a),!0},""),$.validator.addMethod("CountryNotSelected",function(e,n){return""!=e&&"Select Country"!=e}),$.validator.addMethod("ConfirmPassMatch",function(e,n){return e==$("input[name='password']").val()},""),$.validator.addMethod("UserNameExists",function(e,n){return!parseInt($("#username-exists").val())},""),$.validator.addMethod("EmailExists",function(e,n){return!parseInt($("#email-exists").val())},""),$.validator.addMethod("ValidUsername",function(e,n){return e.indexOf("@")<0},"")}),invoicesUnlimited.controller("SignupController",["$rootScope","$scope","$state","signUpFactory","userFactory",function(e,n,t,a,i){i.entity.length&&!a.getVerification.code()&&(showLoader(),i.logout().then(function(){hideLoader()})),$("input").keyup(function(e){var n=e.target.id;$("#"+n+"-error").css("display","none"),$("#"+n).removeClass("error")}),a.setDefaultValues(),$("#phone").mask("(Z00) 000-0000",{translation:{Z:{pattern:/[2-9]/g}}});var o=function(){$(".extended-signup").css({display:"none"})&&$(".extended-signup").show(),-1!=$.inArray(n.selectedCountry,n.usaAndCanada)?($("input#email").attr("placeholder","Email (To Recover Forgotten Password)"),$("input#phone").attr("placeholder","Phone Number (Text Verification Required)"),a.setVerification.provider("text")):($("input#email").attr("placeholder","Email"),$("input#phone").attr("placeholder","Phone Number"),a.setVerification.provider("email"))},s=a.getField("User","country");s&&o(),n.selectedCountry=""==s?"Select Country":s;var r=["email","username","password","company","country"];r.forEach(function(e){$("input[name="+e+"]").val(a.getField("User",e))}),$("#signUpForm").validate({onkeyup:function(e){$(e).valid()},onfocusout:!1,rules:{username:{required:!0,UserNameExists:!0,ValidUsername:!0},email:{required:!0,email:!0,EmailExists:!0},password:{required:!0,minlength:6}},messages:{username:{required:"Please specify your username !",UserNameExists:"The username is already taken!",ValidUsername:"Username cannot contain @"},email:{required:"Please specify your email !",email:"Please write valid email address",EmailExists:"The email is already taken!"},password:{required:"Please specify your password !",minlength:"Password should contain at least 6 characters"}}}),n.ValidateForm=function(e){var n=new Parse.Query(Parse.User);n.equalTo("username",$("input[name=username]").val());var t=new Parse.Query(Parse.User);t.equalTo("email",$("input[name=email]").val());var a=function(e,n){e?$("#"+n+"-exists").val(1):$("#"+n+"-exists").val(0)},i=n.first().then(function(e){a(e,"username")}),o=t.first().then(function(e){a(e,"email")});Parse.Promise.when([i,o]).then(function(){var n=$("#signUpForm").valid();e(!parseInt($("#username-exists").val())&&!parseInt($("#email-exists").val())&&n)})},n.selectedCountryChanged=function(){$("#signUpForm").validate().element("[name=country]")&&o()},n.sendMessage=function(){showLoader();n.ValidateForm(function(n){if(n){$("#company").val($("#username").val()),$("#country").val("United States of America"),r.forEach(function(e){a.setField("User",e,$("input[name="+e+"]").val())});a.setVerification.code("1234");var o=Parse.Object.extend("InvoiceTemplate"),s=new Parse.Query(o);s.equalTo("name","Template 1"),s.first().then(function(n){a.setField("User","defaultTemplate",n),a.signup().then(function(){var e=i.entity[0];return["BusinessInfo","AccountInfo","PrincipalInfo","Organization","Signature","Currency","Preferences","Role"].forEach(function(n){a.setField(n,"userID",e)}),["Organization","Role"].forEach(function(n){a.setField(n,"name",e.company)}),a.setField("Organization","email",e.email),a.create("Role")},function(e){console.log(e.message)}).then(function(){return a.create("Organization")},function(e){console.log(e.message)}).then(function(e){return a.copyDefaultCategories({user:i.entity[0],organization:e}).then(function(){return e})}).then(function(e){["BusinessInfo","AccountInfo","PrincipalInfo","Signature","Preferences","Currency"].forEach(function(n){a.setField(n,"organization",e)});var n=a.create("Currency"),t=a.create("Preferences");return Parse.Promise.when([n,t])},function(e){console.log(e.message)}).then(function(n,a){hideLoader(),e.fromPaymentSettings=!1,t.go("signup.accountActivated")},function(e){e.length?e.forEach(function(e){console.log(e.message)}):console.log(e.message)})});var u={};u.dest="email",u.email=$("input[name=email]").val()}else hideLoader()})},n.openPrivacyPolicy=function(){var e=$("#theFrame");e.attr("src","http://www.merchantaccountsolutions.com/Home/Privacy"),e.css("display","block")},$.reject({reject:{safari:!0,firefox:!0,msie:!0,opera:!0,konqueror:!0,unknown:!0},display:["chrome"],browserInfo:{chrome:{text:"Google Chrome",url:"http://www.google.com/chrome/"}},header:"",paragraph1:"Invoices Unlimited is optimized for Google Chrome. If you continue to use this browser you may run into some issues.",paragraph2:"Just click on the icon to get to the download page",close:!0,closeMessage:"By closing this window you acknowledge that your experience on this website may be degraded",closeLink:"Close This Window",closeESC:!0,closeCookie:!0,cookieSettings:{path:"/",expires:0},imagePath:"./assets/images/"}),n.usaAndCanada=["United States of America","Canada"],n.otherCountries=["Afghanistan","Albania","Algeria","Andorra","Angola","Antigua and Barbuda","Argentina","Armenia","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil","Brunei Darussalam","Bulgaria","Burkina Faso","Burundi","Cabo Verde","Cambodia","Cameroon","Central African Republic","Chad","Chile","China","Colombia","Comoros","Congo","Costa Rica","Cфte d'Ivoire","Croatia","Cuba","Cyprus","Czech Republic","Democratic People's Republic of Korea (North Korea)","Democratic Republic of the Cong","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Ethiopia","Fiji","Finland","France","Gabon","Gambia","Georgia","Germany","Ghana","Greece","Grenada","Guatemala","Guinea","Guinea-Bissau","Guyana","Haiti","Honduras","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy","Jamaica","Japan","Jordan","Kazakhstan","Kenya","Kiribati","Kuwait","Kyrgyzstan","Lao People's Democratic Republic (Laos)","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macedonia","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Mauritania","Mauritius","Mexico","Micronesia (Federated States of)","Monaco","Mongolia","Montenegro","Morocco","Mozambique","Myanmar","Namibia","Nauru","Nepal","Netherlands","New Zealand","Nicaragua","Niger","Nigeria","Norway","Oman","Pakistan","Palau","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Poland","Portugal","Qatar","Republic of Korea (South Korea)","Republic of Moldova","Romania","Russian Federation","Rwanda","Saint Kitts and Nevis","Saint Lucia","Saint Vincent and the Grenadines","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Sudan","Spain","Sri Lanka","Sudan","Suriname","Swaziland","Sweden","Switzerland","Syrian Arab Republic","Tajikistan","Thailand","Timor-Leste","Togo","Tonga","Trinidad and Tobago","Tunisia","Turkey","Turkmenistan","Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom of Great Britain and Northern Ireland","United Republic of Tanzania","Uruguay","Uzbekistan","Vanuatu","Venezuela","Vietnam","Yemen","Zambia","Zimbabwe"]}]),invoicesUnlimited.controller("VerificationController",["$rootScope","$scope","$state","userFullFactory","signUpFactory","userFactory",function(e,n,t,a,i,o){if(i.getVerification.code()){$.validator.addMethod("CodeMatch",function(e,n){return!0}),$("#signUpForm").validate({onkeyup:function(e){$(e).valid()},onfocusout:!1,rules:{code:{required:!0,CodeMatch:!0}},messages:{code:{required:"Verification Code is empty!",CodeMatch:"Verification Code is wrong!"}}});var s=!1;n.codeChanged=function(){s&&($("#signUpForm").validate().resetForm(),s=!1)},n.verificationCodeProvider=i.getVerification.provider(),n.verifyCode=function(){$("#signUpForm").valid()?(showLoader(),i.signup().then(function(){var e=o.entity[0];return["BusinessInfo","AccountInfo","PrincipalInfo","Organization","Signature","Currency","Preferences","Role"].forEach(function(n){i.setField(n,"userID",e)}),["Organization","Role"].forEach(function(n){i.setField(n,"name",e.company)}),i.setField("Organization","email",e.email),i.create("Role")},function(e){console.log(e.message)}).then(function(){return i.create("Organization")},function(e){console.log(e.message)}).then(function(e){return i.copyDefaultCategories({user:o.entity[0],organization:e}).then(function(){return e})}).then(function(e){["BusinessInfo","AccountInfo","PrincipalInfo","Signature","Preferences","Currency"].forEach(function(n){i.setField(n,"organization",e)});var n=i.create("Currency"),t=i.create("Preferences");return Parse.Promise.when([n,t])},function(e){console.log(e.message)}).then(function(n,a){hideLoader(),e.fromPaymentSettings=!1,t.go("signup.business-info")},function(e){e.length?e.forEach(function(e){console.log(e.message)}):console.log(e.message)})):s=!0},n.changePhoneNumber=function(){t.go("signup")}}else t.go("signup")}]);